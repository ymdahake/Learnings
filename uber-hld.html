<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uber ‚Äî High-Level Design (HLD)</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --surface2: #1a1a26;
  --border: #2a2a3a;
  --text: #e8e8f0;
  --text-dim: #8888a0;
  --accent: #00d4aa;
  --accent2: #7b61ff;
  --accent3: #ff6b6b;
  --accent4: #ffd93d;
  --accent5: #4ecdc4;
  --blue: #4a9eff;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  line-height: 1.7;
  overflow-x: hidden;
}

.hero {
  min-height: 60vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 80px 24px;
  position: relative;
  background: radial-gradient(ellipse at 50% 0%, rgba(0,212,170,0.08) 0%, transparent 60%),
              radial-gradient(ellipse at 80% 80%, rgba(123,97,255,0.06) 0%, transparent 50%);
}

.hero::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(0,212,170,0.03) 1px, transparent 1px),
    radial-gradient(circle at 80% 70%, rgba(123,97,255,0.03) 1px, transparent 1px);
  background-size: 60px 60px, 80px 80px;
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 16px;
  border: 1px solid var(--border);
  border-radius: 100px;
  font-size: 13px;
  color: var(--accent);
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 32px;
  background: rgba(0,212,170,0.05);
}

h1 {
  font-size: clamp(48px, 8vw, 96px);
  font-weight: 800;
  letter-spacing: -3px;
  line-height: 1;
  margin-bottom: 20px;
  background: linear-gradient(135deg, var(--text) 0%, var(--accent) 50%, var(--accent2) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.hero p {
  font-size: 18px;
  color: var(--text-dim);
  max-width: 600px;
  font-weight: 300;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
}

section {
  padding: 80px 0;
  border-top: 1px solid var(--border);
}

.section-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--accent);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 12px;
}

h2 {
  font-size: clamp(28px, 4vw, 42px);
  font-weight: 700;
  letter-spacing: -1.5px;
  margin-bottom: 24px;
}

h3 {
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--accent);
}

p { margin-bottom: 16px; color: var(--text-dim); }
p strong { color: var(--text); font-weight: 600; }

/* Diagram Containers */
.diagram-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 40px;
  margin: 32px 0;
  overflow-x: auto;
}

.diagram-title {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  color: var(--accent2);
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.diagram-title::before {
  content: '‚óÜ';
  color: var(--accent);
}

/* Architecture SVG Diagrams */
svg text {
  font-family: 'Outfit', sans-serif;
}

/* Key Decision Cards */
.decisions-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  gap: 20px;
  margin: 32px 0;
}

.decision-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 28px;
  transition: border-color 0.3s, transform 0.3s;
}

.decision-card:hover {
  border-color: var(--accent);
  transform: translateY(-2px);
}

.decision-number {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--accent2);
  margin-bottom: 10px;
  letter-spacing: 2px;
}

.decision-card h4 {
  font-size: 17px;
  font-weight: 600;
  margin-bottom: 10px;
  color: var(--text);
}

.decision-card p {
  font-size: 14px;
  line-height: 1.6;
  color: var(--text-dim);
}

.tag {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  font-family: 'JetBrains Mono', monospace;
  margin-right: 6px;
  margin-bottom: 8px;
}

.tag-green { background: rgba(0,212,170,0.12); color: var(--accent); }
.tag-purple { background: rgba(123,97,255,0.12); color: var(--accent2); }
.tag-red { background: rgba(255,107,107,0.12); color: var(--accent3); }
.tag-yellow { background: rgba(255,217,61,0.12); color: var(--accent4); }
.tag-blue { background: rgba(74,158,255,0.12); color: var(--blue); }

/* Requirements Table */
.req-table {
  width: 100%;
  border-collapse: collapse;
  margin: 24px 0;
  font-size: 14px;
}

.req-table th {
  text-align: left;
  padding: 14px 16px;
  border-bottom: 2px solid var(--accent);
  font-weight: 600;
  color: var(--accent);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.req-table td {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  color: var(--text-dim);
}

.req-table tr:hover td {
  color: var(--text);
  background: rgba(0,212,170,0.03);
}

/* Flow Steps */
.flow-steps {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 32px 0;
}

.flow-step {
  display: flex;
  gap: 20px;
  align-items: flex-start;
  position: relative;
}

.flow-step-line {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 40px;
}

.flow-step-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--accent);
  border: 3px solid var(--bg);
  box-shadow: 0 0 0 2px var(--accent);
  z-index: 1;
  flex-shrink: 0;
}

.flow-step-connector {
  width: 2px;
  flex-grow: 1;
  min-height: 40px;
  background: linear-gradient(to bottom, var(--accent), var(--border));
}

.flow-step-content {
  padding-bottom: 32px;
}

.flow-step-content h4 {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 6px;
  color: var(--text);
}

.flow-step-content p {
  font-size: 13px;
  color: var(--text-dim);
  margin: 0;
}

/* Info Callout */
.callout {
  background: linear-gradient(135deg, rgba(0,212,170,0.06), rgba(123,97,255,0.06));
  border-left: 3px solid var(--accent);
  border-radius: 0 12px 12px 0;
  padding: 20px 24px;
  margin: 24px 0;
  font-size: 14px;
}

.callout strong { color: var(--accent); }

/* Tabs for diagrams */
.tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}

.tab-btn {
  padding: 8px 18px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-dim);
  border-radius: 8px;
  cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  transition: all 0.2s;
}

.tab-btn:hover { border-color: var(--accent); color: var(--text); }
.tab-btn.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }

.tab-content { display: none; }
.tab-content.active { display: block; }

/* Component Grid */
.comp-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
  margin: 24px 0;
}

.comp-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 22px;
}

.comp-card h4 {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.comp-card p {
  font-size: 13px;
  margin: 0;
  color: var(--text-dim);
}

.comp-icon {
  width: 28px;
  height: 28px;
  border-radius: 7px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
}

footer {
  text-align: center;
  padding: 60px 24px;
  border-top: 1px solid var(--border);
  color: var(--text-dim);
  font-size: 13px;
}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <div class="hero-badge">System Design</div>
  <h1>Uber HLD</h1>
  <p>A deep dive into the high-level architecture of Uber's ride-hailing platform ‚Äî covering services, data flow, key design decisions, and scalability patterns.</p>
</div>

<div class="container">

<!-- 1. REQUIREMENTS -->
<section id="requirements">
  <div class="section-label">01 ‚Äî Requirements</div>
  <h2>Functional & Non-Functional Requirements</h2>

  <h3>Functional Requirements</h3>
  <table class="req-table">
    <thead><tr><th>Feature</th><th>Rider</th><th>Driver</th></tr></thead>
    <tbody>
      <tr><td>Authentication</td><td>Sign up / Login / OTP</td><td>Sign up / Login / Verification</td></tr>
      <tr><td>Location</td><td>Set pickup & drop-off</td><td>Broadcast real-time GPS location</td></tr>
      <tr><td>Ride Request</td><td>Request a ride, see ETA & fare estimate</td><td>Accept / Reject ride requests</td></tr>
      <tr><td>Matching</td><td>Get matched with nearest driver</td><td>Receive ride match notification</td></tr>
      <tr><td>Tracking</td><td>Track driver in real-time</td><td>Navigate to rider & destination</td></tr>
      <tr><td>Payments</td><td>Pay via card / wallet / cash</td><td>Receive earnings, view history</td></tr>
      <tr><td>Rating</td><td>Rate driver & provide feedback</td><td>Rate rider & provide feedback</td></tr>
      <tr><td>Trip History</td><td>View past trips & receipts</td><td>View completed trips & earnings</td></tr>
    </tbody>
  </table>

  <h3>Non-Functional Requirements</h3>
  <div class="comp-grid">
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(0,212,170,0.15);color:var(--accent);">‚ö°</span> Low Latency</h4>
      <p>Matching must happen in &lt;5 seconds. Real-time location updates every 3-4 seconds.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(123,97,255,0.15);color:var(--accent2);">üìà</span> High Availability</h4>
      <p>99.99% uptime. The system must work 24/7 across all cities globally.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(255,107,107,0.15);color:var(--accent3);">üåç</span> Scalability</h4>
      <p>Handle millions of concurrent riders & drivers. Support peak loads (NYE, rush hours).</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(255,217,61,0.15);color:var(--accent4);">üîí</span> Consistency</h4>
      <p>One ride ‚Üí one driver. No double-booking. Payment consistency is critical.</p>
    </div>
  </div>

  <div class="callout">
    <strong>Scale Numbers:</strong> Uber handles ~20M+ rides/day, 5M+ drivers, location updates from millions of devices every 4 seconds, across 10,000+ cities worldwide.
  </div>
</section>

<!-- 2. HIGH-LEVEL ARCHITECTURE -->
<section id="architecture">
  <div class="section-label">02 ‚Äî Architecture</div>
  <h2>High-Level Architecture Overview</h2>
  <p>Uber follows a <strong>microservices architecture</strong> with domain-driven service boundaries. Below is the bird's-eye view of how all major components interact.</p>

  <div class="diagram-box">
    <div class="diagram-title">High-Level Architecture Diagram</div>
    <svg viewBox="0 0 1100 720" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:1100px;">
      <!-- Background grid -->
      <defs>
        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#1a1a26" stroke-width="0.5"/>
        </pattern>
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <marker id="arrow" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="10" markerHeight="6" orient="auto"><path d="M0,0 L10,3 L0,6" fill="#00d4aa" opacity="0.7"/></marker>
        <marker id="arrow-purple" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="10" markerHeight="6" orient="auto"><path d="M0,0 L10,3 L0,6" fill="#7b61ff" opacity="0.7"/></marker>
      </defs>
      <rect width="1100" height="720" fill="var(--surface)" rx="12"/>
      <rect width="1100" height="720" fill="url(#grid)" rx="12"/>

      <!-- CLIENT LAYER -->
      <rect x="30" y="20" width="1040" height="80" rx="10" fill="none" stroke="#2a2a3a" stroke-dasharray="6 4"/>
      <text x="50" y="42" fill="#8888a0" font-size="11" font-weight="600" letter-spacing="2">CLIENT LAYER</text>
      <rect x="60" y="52" width="130" height="36" rx="8" fill="#1a3a2e" stroke="#00d4aa" stroke-width="1.5"/>
      <text x="125" y="75" fill="#00d4aa" font-size="13" text-anchor="middle" font-weight="600">Rider App</text>
      <rect x="220" y="52" width="130" height="36" rx="8" fill="#1e1a3a" stroke="#7b61ff" stroke-width="1.5"/>
      <text x="285" y="75" fill="#7b61ff" font-size="13" text-anchor="middle" font-weight="600">Driver App</text>
      <rect x="380" y="52" width="130" height="36" rx="8" fill="#2a1a1a" stroke="#ff6b6b" stroke-width="1.5"/>
      <text x="445" y="75" fill="#ff6b6b" font-size="13" text-anchor="middle" font-weight="600">Web Dashboard</text>

      <!-- API GATEWAY -->
      <rect x="320" y="130" width="460" height="46" rx="10" fill="#1a2a3a" stroke="#4a9eff" stroke-width="1.5"/>
      <text x="550" y="158" fill="#4a9eff" font-size="14" text-anchor="middle" font-weight="600">API Gateway / Load Balancer (Nginx / Envoy)</text>

      <!-- Lines from clients to gateway -->
      <line x1="125" y1="88" x2="440" y2="130" stroke="#00d4aa" stroke-width="1" opacity="0.4" marker-end="url(#arrow)"/>
      <line x1="285" y1="88" x2="500" y2="130" stroke="#7b61ff" stroke-width="1" opacity="0.4" marker-end="url(#arrow-purple)"/>
      <line x1="445" y1="88" x2="550" y2="130" stroke="#ff6b6b" stroke-width="1" opacity="0.3"/>

      <!-- SERVICES ROW 1 -->
      <rect x="30" y="205" width="1040" height="160" rx="10" fill="none" stroke="#2a2a3a" stroke-dasharray="6 4"/>
      <text x="50" y="227" fill="#8888a0" font-size="11" font-weight="600" letter-spacing="2">CORE MICROSERVICES</text>

      <!-- Service boxes -->
      <rect x="50" y="240" width="160" height="55" rx="8" fill="#12121a" stroke="#00d4aa" stroke-width="1"/>
      <text x="130" y="263" fill="#00d4aa" font-size="12" text-anchor="middle" font-weight="600">Ride Service</text>
      <text x="130" y="281" fill="#8888a0" font-size="10" text-anchor="middle">Ride lifecycle mgmt</text>

      <rect x="230" y="240" width="160" height="55" rx="8" fill="#12121a" stroke="#7b61ff" stroke-width="1"/>
      <text x="310" y="263" fill="#7b61ff" font-size="12" text-anchor="middle" font-weight="600">Matching Service</text>
      <text x="310" y="281" fill="#8888a0" font-size="10" text-anchor="middle">Driver-Rider matching</text>

      <rect x="410" y="240" width="160" height="55" rx="8" fill="#12121a" stroke="#ffd93d" stroke-width="1"/>
      <text x="490" y="263" fill="#ffd93d" font-size="12" text-anchor="middle" font-weight="600">Location Service</text>
      <text x="490" y="281" fill="#8888a0" font-size="10" text-anchor="middle">Real-time GPS tracking</text>

      <rect x="590" y="240" width="160" height="55" rx="8" fill="#12121a" stroke="#ff6b6b" stroke-width="1"/>
      <text x="670" y="263" fill="#ff6b6b" font-size="12" text-anchor="middle" font-weight="600">Pricing / Surge</text>
      <text x="670" y="281" fill="#8888a0" font-size="10" text-anchor="middle">Dynamic fare calc</text>

      <rect x="770" y="240" width="160" height="55" rx="8" fill="#12121a" stroke="#4ecdc4" stroke-width="1"/>
      <text x="850" y="263" fill="#4ecdc4" font-size="12" text-anchor="middle" font-weight="600">ETA Service</text>
      <text x="850" y="281" fill="#8888a0" font-size="10" text-anchor="middle">Route & time estimation</text>

      <!-- Service Row 2 -->
      <rect x="50" y="310" width="160" height="45" rx="8" fill="#12121a" stroke="#4a9eff" stroke-width="1"/>
      <text x="130" y="338" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">User Service</text>

      <rect x="230" y="310" width="160" height="45" rx="8" fill="#12121a" stroke="#4a9eff" stroke-width="1"/>
      <text x="310" y="338" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">Payment Service</text>

      <rect x="410" y="310" width="160" height="45" rx="8" fill="#12121a" stroke="#4a9eff" stroke-width="1"/>
      <text x="490" y="338" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">Notification Svc</text>

      <rect x="590" y="310" width="160" height="45" rx="8" fill="#12121a" stroke="#4a9eff" stroke-width="1"/>
      <text x="670" y="338" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">Maps / Routing</text>

      <rect x="770" y="310" width="160" height="45" rx="8" fill="#12121a" stroke="#4a9eff" stroke-width="1"/>
      <text x="850" y="338" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">Trip History Svc</text>

      <!-- Arrows from gateway to services -->
      <line x1="550" y1="176" x2="130" y2="240" stroke="#00d4aa" stroke-width="1" opacity="0.3" marker-end="url(#arrow)"/>
      <line x1="550" y1="176" x2="310" y2="240" stroke="#7b61ff" stroke-width="1" opacity="0.3" marker-end="url(#arrow-purple)"/>
      <line x1="550" y1="176" x2="490" y2="240" stroke="#ffd93d" stroke-width="1" opacity="0.3"/>
      <line x1="550" y1="176" x2="670" y2="240" stroke="#ff6b6b" stroke-width="1" opacity="0.3"/>
      <line x1="550" y1="176" x2="850" y2="240" stroke="#4ecdc4" stroke-width="1" opacity="0.3"/>

      <!-- MESSAGE BUS -->
      <rect x="100" y="395" width="900" height="42" rx="10" fill="#2a1e1e" stroke="#ff6b6b" stroke-width="1.5" stroke-dasharray="8 4"/>
      <text x="550" y="421" fill="#ff6b6b" font-size="13" text-anchor="middle" font-weight="600">Event Bus ‚Äî Apache Kafka (async communication between services)</text>

      <!-- DATA LAYER -->
      <rect x="30" y="465" width="1040" height="120" rx="10" fill="none" stroke="#2a2a3a" stroke-dasharray="6 4"/>
      <text x="50" y="487" fill="#8888a0" font-size="11" font-weight="600" letter-spacing="2">DATA LAYER</text>

      <rect x="50" y="500" width="145" height="70" rx="10" fill="#1a2a1e" stroke="#00d4aa" stroke-width="1"/>
      <text x="122" y="527" fill="#00d4aa" font-size="12" text-anchor="middle" font-weight="600">PostgreSQL</text>
      <text x="122" y="545" fill="#8888a0" font-size="10" text-anchor="middle">Users, Trips, Payments</text>
      <text x="122" y="559" fill="#8888a0" font-size="10" text-anchor="middle">(Sharded)</text>

      <rect x="215" y="500" width="145" height="70" rx="10" fill="#1a1e2a" stroke="#7b61ff" stroke-width="1"/>
      <text x="287" y="527" fill="#7b61ff" font-size="12" text-anchor="middle" font-weight="600">Redis Cluster</text>
      <text x="287" y="545" fill="#8888a0" font-size="10" text-anchor="middle">Driver locations,</text>
      <text x="287" y="559" fill="#8888a0" font-size="10" text-anchor="middle">Sessions, Caching</text>

      <rect x="380" y="500" width="145" height="70" rx="10" fill="#2a2a1a" stroke="#ffd93d" stroke-width="1"/>
      <text x="452" y="527" fill="#ffd93d" font-size="12" text-anchor="middle" font-weight="600">Cassandra</text>
      <text x="452" y="545" fill="#8888a0" font-size="10" text-anchor="middle">Location history,</text>
      <text x="452" y="559" fill="#8888a0" font-size="10" text-anchor="middle">Analytics, Logs</text>

      <rect x="545" y="500" width="145" height="70" rx="10" fill="#1e2a2a" stroke="#4ecdc4" stroke-width="1"/>
      <text x="617" y="527" fill="#4ecdc4" font-size="12" text-anchor="middle" font-weight="600">S2 / H3 Index</text>
      <text x="617" y="545" fill="#8888a0" font-size="10" text-anchor="middle">Geospatial indexing</text>
      <text x="617" y="559" fill="#8888a0" font-size="10" text-anchor="middle">of driver positions</text>

      <rect x="710" y="500" width="145" height="70" rx="10" fill="#2a1a2a" stroke="#4a9eff" stroke-width="1"/>
      <text x="782" y="527" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">Elasticsearch</text>
      <text x="782" y="545" fill="#8888a0" font-size="10" text-anchor="middle">Search, Autocomplete</text>
      <text x="782" y="559" fill="#8888a0" font-size="10" text-anchor="middle">Address lookup</text>

      <rect x="875" y="500" width="145" height="70" rx="10" fill="#2a2420" stroke="#ffa07a" stroke-width="1"/>
      <text x="947" y="527" fill="#ffa07a" font-size="12" text-anchor="middle" font-weight="600">Object Store</text>
      <text x="947" y="545" fill="#8888a0" font-size="10" text-anchor="middle">Profile pics, docs</text>
      <text x="947" y="559" fill="#8888a0" font-size="10" text-anchor="middle">(S3 / Blob)</text>

      <!-- INFRA LAYER -->
      <rect x="30" y="610" width="1040" height="90" rx="10" fill="none" stroke="#2a2a3a" stroke-dasharray="6 4"/>
      <text x="50" y="632" fill="#8888a0" font-size="11" font-weight="600" letter-spacing="2">INFRASTRUCTURE & OBSERVABILITY</text>

      <rect x="60" y="645" width="180" height="40" rx="8" fill="#12121a" stroke="#2a2a3a" stroke-width="1"/>
      <text x="150" y="670" fill="#8888a0" font-size="12" text-anchor="middle">Kubernetes (K8s)</text>

      <rect x="260" y="645" width="180" height="40" rx="8" fill="#12121a" stroke="#2a2a3a" stroke-width="1"/>
      <text x="350" y="670" fill="#8888a0" font-size="12" text-anchor="middle">Docker Containers</text>

      <rect x="460" y="645" width="180" height="40" rx="8" fill="#12121a" stroke="#2a2a3a" stroke-width="1"/>
      <text x="550" y="670" fill="#8888a0" font-size="12" text-anchor="middle">Prometheus + Grafana</text>

      <rect x="660" y="645" width="180" height="40" rx="8" fill="#12121a" stroke="#2a2a3a" stroke-width="1"/>
      <text x="750" y="670" fill="#8888a0" font-size="12" text-anchor="middle">Jaeger (Tracing)</text>

      <rect x="860" y="645" width="160" height="40" rx="8" fill="#12121a" stroke="#2a2a3a" stroke-width="1"/>
      <text x="940" y="670" fill="#8888a0" font-size="12" text-anchor="middle">CI/CD Pipelines</text>
    </svg>
  </div>
</section>

<!-- 3. RIDE FLOW -->
<section id="ride-flow">
  <div class="section-label">03 ‚Äî Core Flow</div>
  <h2>Ride Request & Matching Flow</h2>
  <p>This is the most critical flow in the system ‚Äî how a rider's request gets matched with the optimal driver.</p>

  <div class="diagram-box">
    <div class="diagram-title">Ride Request Sequence Flow</div>
    <svg viewBox="0 0 1050 560" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:1050px;">
      <rect width="1050" height="560" fill="var(--surface)" rx="12"/>
      <defs>
        <marker id="arr2" viewBox="0 0 8 6" refX="8" refY="3" markerWidth="8" markerHeight="6" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#00d4aa"/></marker>
        <marker id="arr3" viewBox="0 0 8 6" refX="8" refY="3" markerWidth="8" markerHeight="6" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#7b61ff"/></marker>
      </defs>

      <!-- Actor Lines -->
      <line x1="100" y1="60" x2="100" y2="530" stroke="#2a2a3a" stroke-width="1.5" stroke-dasharray="6 4"/>
      <line x1="280" y1="60" x2="280" y2="530" stroke="#2a2a3a" stroke-width="1.5" stroke-dasharray="6 4"/>
      <line x1="460" y1="60" x2="460" y2="530" stroke="#2a2a3a" stroke-width="1.5" stroke-dasharray="6 4"/>
      <line x1="640" y1="60" x2="640" y2="530" stroke="#2a2a3a" stroke-width="1.5" stroke-dasharray="6 4"/>
      <line x1="820" y1="60" x2="820" y2="530" stroke="#2a2a3a" stroke-width="1.5" stroke-dasharray="6 4"/>
      <line x1="960" y1="60" x2="960" y2="530" stroke="#2a2a3a" stroke-width="1.5" stroke-dasharray="6 4"/>

      <!-- Actor Labels -->
      <rect x="40" y="20" width="120" height="32" rx="6" fill="#1a3a2e" stroke="#00d4aa"/>
      <text x="100" y="41" fill="#00d4aa" font-size="12" text-anchor="middle" font-weight="600">Rider App</text>

      <rect x="220" y="20" width="120" height="32" rx="6" fill="#1a2a3a" stroke="#4a9eff"/>
      <text x="280" y="41" fill="#4a9eff" font-size="12" text-anchor="middle" font-weight="600">API Gateway</text>

      <rect x="400" y="20" width="120" height="32" rx="6" fill="#2a2a1a" stroke="#ffd93d"/>
      <text x="460" y="41" fill="#ffd93d" font-size="12" text-anchor="middle" font-weight="600">Ride Service</text>

      <rect x="570" y="20" width="140" height="32" rx="6" fill="#1e1a3a" stroke="#7b61ff"/>
      <text x="640" y="41" fill="#7b61ff" font-size="12" text-anchor="middle" font-weight="600">Matching Svc</text>

      <rect x="760" y="20" width="120" height="32" rx="6" fill="#2a1e1e" stroke="#ff6b6b"/>
      <text x="820" y="41" fill="#ff6b6b" font-size="12" text-anchor="middle" font-weight="600">Location Svc</text>

      <rect x="900" y="20" width="120" height="32" rx="6" fill="#1e2a2a" stroke="#4ecdc4"/>
      <text x="960" y="41" fill="#4ecdc4" font-size="12" text-anchor="middle" font-weight="600">Driver App</text>

      <!-- Step 1: Request Ride -->
      <line x1="100" y1="90" x2="280" y2="90" stroke="#00d4aa" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="190" y="83" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">1. Request Ride</text>
      <text x="190" y="105" fill="#8888a0" font-size="9" text-anchor="middle">(pickup, dropoff, ride type)</text>

      <!-- Step 2: Forward to Ride Service -->
      <line x1="280" y1="135" x2="460" y2="135" stroke="#4a9eff" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="370" y="128" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">2. Create Ride Request</text>

      <!-- Step 3: Get fare estimate -->
      <rect x="415" y="160" width="90" height="28" rx="5" fill="#2a2a1a" stroke="#ffd93d" stroke-width="0.5"/>
      <text x="460" y="179" fill="#ffd93d" font-size="10" text-anchor="middle">Calc fare</text>

      <!-- Step 4: Find drivers -->
      <line x1="460" y1="210" x2="640" y2="210" stroke="#7b61ff" stroke-width="1.5" marker-end="url(#arr3)"/>
      <text x="550" y="203" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">3. Find Nearby Drivers</text>

      <!-- Step 5: Query Location Service -->
      <line x1="640" y1="250" x2="820" y2="250" stroke="#ff6b6b" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="730" y="243" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">4. Query S2/H3 Index</text>
      <text x="730" y="265" fill="#8888a0" font-size="9" text-anchor="middle">(get drivers in radius)</text>

      <!-- Step 6: Return candidates -->
      <line x1="820" y1="295" x2="640" y2="295" stroke="#ff6b6b" stroke-width="1.5" stroke-dasharray="6 3" marker-end="url(#arr3)"/>
      <text x="730" y="288" fill="#8888a0" font-size="10" text-anchor="middle">5. Return candidates</text>

      <!-- Step 7: Rank & Select -->
      <rect x="595" y="315" width="90" height="28" rx="5" fill="#1e1a3a" stroke="#7b61ff" stroke-width="0.5"/>
      <text x="640" y="334" fill="#7b61ff" font-size="10" text-anchor="middle">Rank & Pick</text>

      <!-- Step 8: Send request to driver -->
      <line x1="640" y1="365" x2="960" y2="365" stroke="#4ecdc4" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="800" y="358" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">6. Send Ride Request (Push)</text>

      <!-- Step 9: Driver accepts -->
      <line x1="960" y1="405" x2="640" y2="405" stroke="#4ecdc4" stroke-width="1.5" stroke-dasharray="6 3" marker-end="url(#arr3)"/>
      <text x="800" y="398" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">7. Accept / Reject</text>

      <!-- Step 10: Confirm to rider -->
      <line x1="640" y1="445" x2="460" y2="445" stroke="#7b61ff" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="550" y="438" fill="#8888a0" font-size="10" text-anchor="middle">8. Update ride status</text>

      <line x1="460" y1="480" x2="280" y2="480" stroke="#ffd93d" stroke-width="1.5"/>
      <line x1="280" y1="480" x2="100" y2="480" stroke="#00d4aa" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="290" y="473" fill="#e8e8f0" font-size="11" text-anchor="middle" font-weight="500">9. Ride Confirmed ‚Äî Show Driver Info & ETA</text>

      <!-- Step 11: Live tracking -->
      <line x1="960" y1="515" x2="820" y2="515" stroke="#4ecdc4" stroke-width="1.5" marker-end="url(#arr2)"/>
      <text x="890" y="508" fill="#8888a0" font-size="10" text-anchor="middle">10. Stream GPS</text>

      <line x1="820" y1="515" x2="100" y2="530" stroke="#00d4aa" stroke-width="1" stroke-dasharray="4 3"/>
      <text x="460" y="540" fill="#00d4aa" font-size="10" text-anchor="middle">‚Üí Real-time tracking via WebSocket ‚Üí</text>
    </svg>
  </div>

  <h3>Flow Steps Explained</h3>
  <div class="flow-steps">
    <div class="flow-step">
      <div class="flow-step-line"><div class="flow-step-dot"></div><div class="flow-step-connector"></div></div>
      <div class="flow-step-content">
        <h4>1 ‚Äî Rider Requests a Ride</h4>
        <p>Rider selects pickup/dropoff on the app. A request hits the API Gateway, which authenticates, rate-limits, and routes it to the <strong>Ride Service</strong>.</p>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-line"><div class="flow-step-dot"></div><div class="flow-step-connector"></div></div>
      <div class="flow-step-content">
        <h4>2 ‚Äî Fare Estimation & Ride Creation</h4>
        <p>Ride Service calls the <strong>Pricing/Surge Service</strong> to calculate fare (considering surge multiplier, route distance, ETA). A ride record is created with status <code>REQUESTED</code>.</p>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-line"><div class="flow-step-dot"></div><div class="flow-step-connector"></div></div>
      <div class="flow-step-content">
        <h4>3 ‚Äî Driver Matching via Location Index</h4>
        <p>Matching Service queries the <strong>Location Service</strong>, which uses an <strong>S2/H3 geospatial index</strong> to find all available drivers within a configurable radius. Drivers are ranked by proximity, rating, ETA, and acceptance rate.</p>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-line"><div class="flow-step-dot"></div><div class="flow-step-connector"></div></div>
      <div class="flow-step-content">
        <h4>4 ‚Äî Push Notification to Best Driver</h4>
        <p>The highest-ranked driver receives a push notification with ride details. If they don't respond in ~10s, the request cascades to the next driver.</p>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-line"><div class="flow-step-dot"></div><div class="flow-step-connector"></div></div>
      <div class="flow-step-content">
        <h4>5 ‚Äî Ride Confirmation & Live Tracking</h4>
        <p>Driver accepts ‚Üí ride status moves to <code>ACCEPTED</code>. Rider gets driver info + ETA. A <strong>WebSocket</strong> connection is established for real-time GPS tracking as the driver approaches.</p>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-step-line"><div class="flow-step-dot"></div><div class="flow-step-connector"></div></div>
      <div class="flow-step-content">
        <h4>6 ‚Äî Trip Completion & Payment</h4>
        <p>On trip end, final fare is calculated. Payment Service charges the rider. Both parties rate each other. Trip data is persisted for analytics and history.</p>
      </div>
    </div>
  </div>
</section>

<!-- 4. LOCATION SERVICE DEEP DIVE -->
<section id="location">
  <div class="section-label">04 ‚Äî Location Service</div>
  <h2>Real-Time Location & Geospatial Indexing</h2>
  <p>The location system is the <strong>most write-heavy component</strong> in Uber. Millions of drivers send GPS pings every 3‚Äì4 seconds.</p>

  <div class="diagram-box">
    <div class="diagram-title">Location Service Architecture ‚Äî S2 / H3 Geospatial Indexing</div>
    <svg viewBox="0 0 1050 420" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:1050px;">
      <rect width="1050" height="420" fill="var(--surface)" rx="12"/>

      <!-- Driver sends location -->
      <rect x="30" y="40" width="140" height="60" rx="10" fill="#1e2a2a" stroke="#4ecdc4" stroke-width="1.5"/>
      <text x="100" y="66" fill="#4ecdc4" font-size="13" text-anchor="middle" font-weight="600">Driver App</text>
      <text x="100" y="84" fill="#8888a0" font-size="10" text-anchor="middle">GPS every 3-4s</text>

      <line x1="170" y1="70" x2="240" y2="70" stroke="#4ecdc4" stroke-width="1.5" marker-end="url(#arr2)"/>

      <!-- Location Ingestion -->
      <rect x="240" y="30" width="190" height="80" rx="10" fill="#12121a" stroke="#ffd93d" stroke-width="1.5"/>
      <text x="335" y="58" fill="#ffd93d" font-size="13" text-anchor="middle" font-weight="600">Location Ingestion</text>
      <text x="335" y="76" fill="#8888a0" font-size="10" text-anchor="middle">Batch + buffer updates</text>
      <text x="335" y="92" fill="#8888a0" font-size="10" text-anchor="middle">via Kafka stream</text>

      <!-- Kafka -->
      <line x1="335" y1="110" x2="335" y2="150" stroke="#ff6b6b" stroke-width="1.5"/>
      <rect x="260" y="150" width="150" height="36" rx="6" fill="#2a1e1e" stroke="#ff6b6b" stroke-width="1"/>
      <text x="335" y="173" fill="#ff6b6b" font-size="12" text-anchor="middle" font-weight="600">Kafka Topic</text>

      <!-- Two consumers -->
      <line x1="295" y1="186" x2="160" y2="240" stroke="#ff6b6b" stroke-width="1"/>
      <line x1="375" y1="186" x2="500" y2="240" stroke="#ff6b6b" stroke-width="1"/>

      <!-- Redis - Current Location -->
      <rect x="60" y="240" width="200" height="80" rx="10" fill="#1a1e2a" stroke="#7b61ff" stroke-width="1.5"/>
      <text x="160" y="266" fill="#7b61ff" font-size="13" text-anchor="middle" font-weight="600">Redis Cluster</text>
      <text x="160" y="284" fill="#e8e8f0" font-size="10" text-anchor="middle">Current driver location</text>
      <text x="160" y="300" fill="#8888a0" font-size="10" text-anchor="middle">Key: driver_id ‚Üí {lat, lng, ts}</text>

      <!-- S2/H3 Index -->
      <rect x="400" y="240" width="200" height="80" rx="10" fill="#1e2a2a" stroke="#00d4aa" stroke-width="1.5"/>
      <text x="500" y="266" fill="#00d4aa" font-size="13" text-anchor="middle" font-weight="600">S2 / H3 Index</text>
      <text x="500" y="284" fill="#e8e8f0" font-size="10" text-anchor="middle">Geospatial cell mapping</text>
      <text x="500" y="300" fill="#8888a0" font-size="10" text-anchor="middle">Cell ‚Üí Set of driver_ids</text>

      <!-- Cassandra for history -->
      <rect x="400" y="355" width="200" height="50" rx="10" fill="#2a2a1a" stroke="#ffd93d" stroke-width="1"/>
      <text x="500" y="385" fill="#ffd93d" font-size="12" text-anchor="middle" font-weight="600">Cassandra ‚Äî Location History</text>

      <line x1="500" y1="320" x2="500" y2="355" stroke="#ffd93d" stroke-width="1" stroke-dasharray="4 3"/>

      <!-- Matching queries -->
      <rect x="720" y="40" width="180" height="70" rx="10" fill="#1e1a3a" stroke="#7b61ff" stroke-width="1.5"/>
      <text x="810" y="66" fill="#7b61ff" font-size="13" text-anchor="middle" font-weight="600">Matching Service</text>
      <text x="810" y="86" fill="#8888a0" font-size="10" text-anchor="middle">"Find drivers near X"</text>

      <line x1="720" y1="85" x2="600" y2="270" stroke="#7b61ff" stroke-width="1.5" stroke-dasharray="6 3" marker-end="url(#arr3)"/>
      <text x="680" y="180" fill="#7b61ff" font-size="10" text-anchor="middle" transform="rotate(-55 680 180)">Query S2 cells</text>

      <!-- How S2 works visual -->
      <rect x="720" y="170" width="300" height="230" rx="12" fill="#12121a" stroke="#2a2a3a"/>
      <text x="870" y="196" fill="#00d4aa" font-size="13" text-anchor="middle" font-weight="600">How S2/H3 Indexing Works</text>

      <!-- Grid visualization -->
      <rect x="740" y="210" width="60" height="60" rx="2" fill="none" stroke="#2a2a3a" stroke-width="1"/>
      <rect x="800" y="210" width="60" height="60" rx="2" fill="rgba(0,212,170,0.12)" stroke="#00d4aa" stroke-width="1.5"/>
      <rect x="860" y="210" width="60" height="60" rx="2" fill="none" stroke="#2a2a3a" stroke-width="1"/>
      <rect x="740" y="270" width="60" height="60" rx="2" fill="rgba(0,212,170,0.06)" stroke="#00d4aa" stroke-width="0.5" stroke-dasharray="3 3"/>
      <rect x="800" y="270" width="60" height="60" rx="2" fill="rgba(0,212,170,0.12)" stroke="#00d4aa" stroke-width="1.5"/>
      <rect x="860" y="270" width="60" height="60" rx="2" fill="rgba(0,212,170,0.06)" stroke="#00d4aa" stroke-width="0.5" stroke-dasharray="3 3"/>
      <rect x="740" y="330" width="60" height="60" rx="2" fill="none" stroke="#2a2a3a" stroke-width="1"/>
      <rect x="800" y="330" width="60" height="60" rx="2" fill="none" stroke="#2a2a3a" stroke-width="1"/>
      <rect x="860" y="330" width="60" height="60" rx="2" fill="none" stroke="#2a2a3a" stroke-width="1"/>

      <!-- Dots for drivers -->
      <circle cx="815" cy="235" r="4" fill="#00d4aa"/>
      <circle cx="840" cy="255" r="4" fill="#00d4aa"/>
      <circle cx="825" cy="290" r="4" fill="#00d4aa"/>
      <circle cx="810" cy="310" r="4" fill="#00d4aa"/>

      <!-- Rider dot -->
      <circle cx="830" cy="275" r="6" fill="#ff6b6b" stroke="#fff" stroke-width="1.5"/>
      <text x="830" y="275" fill="#fff" font-size="6" text-anchor="middle" dominant-baseline="central">R</text>

      <!-- Legend -->
      <circle cx="940" y="230" r="4" fill="#00d4aa"/><text x="950" y="234" fill="#8888a0" font-size="9">Driver</text>
      <circle cx="940" y="255" r="5" fill="#ff6b6b"/><text x="950" y="259" fill="#8888a0" font-size="9">Rider</text>
      <rect x="933" y="275" width="14" height="14" rx="1" fill="rgba(0,212,170,0.12)" stroke="#00d4aa"/>
      <text x="953" y="286" fill="#8888a0" font-size="9">Search cells</text>
    </svg>
  </div>

  <div class="callout">
    <strong>Why S2/H3?</strong> Traditional lat/lng radius queries don't scale. S2 (Google) and H3 (Uber) divide Earth into hierarchical cells. To find nearby drivers, you just look up the cell the rider is in + neighboring cells. It's an O(1) lookup instead of a full spatial scan. Uber developed H3 specifically for this purpose.
  </div>
</section>

<!-- 5. KEY DECISIONS -->
<section id="decisions">
  <div class="section-label">05 ‚Äî Key Design Decisions</div>
  <h2>Critical Architectural Decisions</h2>
  <p>These are the decisions that define Uber's architecture and separate it from a naive implementation.</p>

  <div class="decisions-grid">
    <div class="decision-card">
      <div class="decision-number">DECISION 01</div>
      <span class="tag tag-green">GEOSPATIAL</span>
      <h4>H3 Hexagonal Indexing over Quadtree/R-Tree</h4>
      <p>Uber built H3, a hexagonal hierarchical spatial index. Hexagons have uniform adjacency (6 neighbors, equal distances) unlike squares, making proximity queries more accurate. This replaced their earlier Google S2-based approach.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 02</div>
      <span class="tag tag-purple">MESSAGING</span>
      <h4>Kafka for Async Event-Driven Communication</h4>
      <p>Instead of synchronous HTTP between all services, Uber uses Kafka for high-throughput async messaging. Location updates, trip events, and analytics all flow through Kafka ‚Äî enabling decoupling, replay, and fault tolerance.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 03</div>
      <span class="tag tag-red">CONSISTENCY</span>
      <h4>One Ride ‚Üí One Driver (Exclusive Locking)</h4>
      <p>To prevent double-booking, the Matching Service uses distributed locks (via Redis or ZooKeeper). Once a driver is sent a request, they're temporarily "locked" so no other ride request targets them simultaneously.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 04</div>
      <span class="tag tag-yellow">STORAGE</span>
      <h4>Polyglot Persistence ‚Äî Right DB for the Job</h4>
      <p><strong>PostgreSQL</strong> for transactional data (users, trips, payments). <strong>Redis</strong> for real-time driver locations and caching. <strong>Cassandra</strong> for high-write append-only data (location history, logs). <strong>Elasticsearch</strong> for search.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 05</div>
      <span class="tag tag-blue">REAL-TIME</span>
      <h4>WebSockets + Push for Live Tracking</h4>
      <p>HTTP polling doesn't scale for real-time tracking. Uber uses persistent WebSocket connections between rider app and server. Server-Sent Events (SSE) is used where full duplex isn't needed. Push notifications via APNS/FCM for ride alerts.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 06</div>
      <span class="tag tag-green">PRICING</span>
      <h4>Surge Pricing ‚Äî Dynamic Supply-Demand Model</h4>
      <p>When demand exceeds supply in an H3 cell, the surge multiplier increases. This incentivizes more drivers to that area. The Pricing Service queries real-time supply/demand per geo-cell to compute the multiplier dynamically.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 07</div>
      <span class="tag tag-purple">RELIABILITY</span>
      <h4>Circuit Breakers & Graceful Degradation</h4>
      <p>If the Matching Service is overloaded, it can degrade (e.g., skip ranking optimization and just pick the nearest driver). Circuit breakers prevent cascade failures between services. Retry queues handle transient errors.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 08</div>
      <span class="tag tag-red">SCALE</span>
      <h4>Database Sharding by City / Region</h4>
      <p>Uber shards its primary databases by city/region. A ride in New York never needs to query data in London. This provides natural data locality and allows each region to scale independently.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 09</div>
      <span class="tag tag-yellow">MATCHING</span>
      <h4>Batched Matching over Greedy 1:1</h4>
      <p>Instead of matching each rider to the nearest driver instantly, Uber batches requests in ~2s windows and solves a global optimization (Hungarian algorithm variant) to find the best overall matching for all riders and drivers.</p>
    </div>
    <div class="decision-card">
      <div class="decision-number">DECISION 10</div>
      <span class="tag tag-blue">ARCHITECTURE</span>
      <h4>Microservices with Domain Boundaries</h4>
      <p>Uber famously migrated from a monolith to ~2,000+ microservices. Each service owns its domain (rides, payments, users). Services communicate via gRPC for sync calls and Kafka for async events. Deployed on Kubernetes.</p>
    </div>
  </div>
</section>

<!-- 6. DATA MODEL -->
<section id="data-model">
  <div class="section-label">06 ‚Äî Data Model</div>
  <h2>Core Data Entities</h2>

  <div class="diagram-box">
    <div class="diagram-title">Simplified Entity Relationship Overview</div>
    <svg viewBox="0 0 1050 440" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:1050px;">
      <rect width="1050" height="440" fill="var(--surface)" rx="12"/>

      <!-- User Entity -->
      <rect x="40" y="30" width="260" height="180" rx="10" fill="#12121a" stroke="#00d4aa" stroke-width="1.5"/>
      <rect x="40" y="30" width="260" height="34" rx="10" fill="rgba(0,212,170,0.12)"/>
      <rect x="40" y="54" width="260" height="10" rx="0" fill="#12121a"/>
      <text x="170" y="52" fill="#00d4aa" font-size="14" text-anchor="middle" font-weight="700">User</text>
      <text x="55" y="84" fill="#ffd93d" font-size="11" font-family="JetBrains Mono">PK</text><text x="85" y="84" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">user_id       UUID</text>
      <text x="85" y="104" fill="#8888a0" font-size="11" font-family="JetBrains Mono">name          String</text>
      <text x="85" y="124" fill="#8888a0" font-size="11" font-family="JetBrains Mono">email         String</text>
      <text x="85" y="144" fill="#8888a0" font-size="11" font-family="JetBrains Mono">phone         String</text>
      <text x="85" y="164" fill="#8888a0" font-size="11" font-family="JetBrains Mono">role          RIDER|DRIVER</text>
      <text x="85" y="184" fill="#8888a0" font-size="11" font-family="JetBrains Mono">rating        Float</text>
      <text x="85" y="200" fill="#8888a0" font-size="11" font-family="JetBrains Mono">created_at    Timestamp</text>

      <!-- Ride/Trip Entity -->
      <rect x="400" y="30" width="260" height="230" rx="10" fill="#12121a" stroke="#7b61ff" stroke-width="1.5"/>
      <rect x="400" y="30" width="260" height="34" rx="10" fill="rgba(123,97,255,0.12)"/>
      <rect x="400" y="54" width="260" height="10" rx="0" fill="#12121a"/>
      <text x="530" y="52" fill="#7b61ff" font-size="14" text-anchor="middle" font-weight="700">Trip</text>
      <text x="415" y="84" fill="#ffd93d" font-size="11" font-family="JetBrains Mono">PK</text><text x="445" y="84" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">trip_id        UUID</text>
      <text x="415" y="104" fill="#4a9eff" font-size="11" font-family="JetBrains Mono">FK</text><text x="445" y="104" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">rider_id       UUID</text>
      <text x="415" y="124" fill="#4a9eff" font-size="11" font-family="JetBrains Mono">FK</text><text x="445" y="124" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">driver_id      UUID</text>
      <text x="445" y="144" fill="#8888a0" font-size="11" font-family="JetBrains Mono">pickup_loc     Point</text>
      <text x="445" y="164" fill="#8888a0" font-size="11" font-family="JetBrains Mono">dropoff_loc    Point</text>
      <text x="445" y="184" fill="#8888a0" font-size="11" font-family="JetBrains Mono">status         Enum</text>
      <text x="445" y="204" fill="#8888a0" font-size="11" font-family="JetBrains Mono">fare           Decimal</text>
      <text x="445" y="224" fill="#8888a0" font-size="11" font-family="JetBrains Mono">surge_multi    Float</text>
      <text x="445" y="244" fill="#8888a0" font-size="11" font-family="JetBrains Mono">started_at     Timestamp</text>

      <!-- Payment Entity -->
      <rect x="760" y="30" width="260" height="180" rx="10" fill="#12121a" stroke="#ff6b6b" stroke-width="1.5"/>
      <rect x="760" y="30" width="260" height="34" rx="10" fill="rgba(255,107,107,0.12)"/>
      <rect x="760" y="54" width="260" height="10" rx="0" fill="#12121a"/>
      <text x="890" y="52" fill="#ff6b6b" font-size="14" text-anchor="middle" font-weight="700">Payment</text>
      <text x="775" y="84" fill="#ffd93d" font-size="11" font-family="JetBrains Mono">PK</text><text x="805" y="84" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">payment_id     UUID</text>
      <text x="775" y="104" fill="#4a9eff" font-size="11" font-family="JetBrains Mono">FK</text><text x="805" y="104" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">trip_id        UUID</text>
      <text x="805" y="124" fill="#8888a0" font-size="11" font-family="JetBrains Mono">amount         Decimal</text>
      <text x="805" y="144" fill="#8888a0" font-size="11" font-family="JetBrains Mono">method         Enum</text>
      <text x="805" y="164" fill="#8888a0" font-size="11" font-family="JetBrains Mono">status         Enum</text>
      <text x="805" y="184" fill="#8888a0" font-size="11" font-family="JetBrains Mono">gateway_ref    String</text>
      <text x="805" y="200" fill="#8888a0" font-size="11" font-family="JetBrains Mono">created_at     Timestamp</text>

      <!-- Driver Location Entity -->
      <rect x="40" y="270" width="260" height="150" rx="10" fill="#12121a" stroke="#4ecdc4" stroke-width="1.5"/>
      <rect x="40" y="270" width="260" height="34" rx="10" fill="rgba(78,205,196,0.12)"/>
      <rect x="40" y="294" width="260" height="10" rx="0" fill="#12121a"/>
      <text x="170" y="292" fill="#4ecdc4" font-size="14" text-anchor="middle" font-weight="700">DriverLocation (Redis)</text>
      <text x="55" y="324" fill="#ffd93d" font-size="11" font-family="JetBrains Mono">PK</text><text x="85" y="324" fill="#e8e8f0" font-size="11" font-family="JetBrains Mono">driver_id      UUID</text>
      <text x="85" y="344" fill="#8888a0" font-size="11" font-family="JetBrains Mono">latitude       Double</text>
      <text x="85" y="364" fill="#8888a0" font-size="11" font-family="JetBrains Mono">longitude      Double</text>
      <text x="85" y="384" fill="#8888a0" font-size="11" font-family="JetBrains Mono">h3_cell        String</text>
      <text x="85" y="404" fill="#8888a0" font-size="11" font-family="JetBrains Mono">is_available   Boolean</text>

      <!-- Relationships -->
      <line x1="300" y1="100" x2="400" y2="100" stroke="#00d4aa" stroke-width="1.5"/>
      <text x="350" y="93" fill="#00d4aa" font-size="9" text-anchor="middle">1 : N</text>

      <line x1="660" y1="100" x2="760" y2="100" stroke="#7b61ff" stroke-width="1.5"/>
      <text x="710" y="93" fill="#7b61ff" font-size="9" text-anchor="middle">1 : 1</text>

      <line x1="170" y1="210" x2="170" y2="270" stroke="#4ecdc4" stroke-width="1" stroke-dasharray="4 3"/>
      <text x="180" y="245" fill="#4ecdc4" font-size="9">1:1 (live)</text>

      <!-- Trip status enum -->
      <rect x="450" y="290" width="220" height="130" rx="10" fill="#12121a" stroke="#2a2a3a"/>
      <text x="560" y="315" fill="#ffd93d" font-size="12" text-anchor="middle" font-weight="600">Trip Status Enum</text>
      <text x="470" y="340" fill="#00d4aa" font-size="11" font-family="JetBrains Mono">REQUESTED</text>
      <text x="470" y="360" fill="#4a9eff" font-size="11" font-family="JetBrains Mono">MATCHED</text>
      <text x="470" y="380" fill="#7b61ff" font-size="11" font-family="JetBrains Mono">DRIVER_EN_ROUTE</text>
      <text x="470" y="400" fill="#4ecdc4" font-size="11" font-family="JetBrains Mono">IN_PROGRESS</text>
      <text x="600" y="340" fill="#ffd93d" font-size="11" font-family="JetBrains Mono">COMPLETED</text>
      <text x="600" y="360" fill="#ff6b6b" font-size="11" font-family="JetBrains Mono">CANCELLED</text>
      <text x="600" y="380" fill="#8888a0" font-size="11" font-family="JetBrains Mono">PAYMENT_PENDING</text>
    </svg>
  </div>
</section>

<!-- 7. SCALABILITY -->
<section id="scalability">
  <div class="section-label">07 ‚Äî Scalability & Reliability</div>
  <h2>How Uber Handles Scale</h2>

  <div class="comp-grid">
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(0,212,170,0.15);color:var(--accent);">üóÇ</span> Database Sharding</h4>
      <p>Primary DBs are sharded by city/region. Each shard handles its own reads/writes independently. Cross-shard queries are avoided by design.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(123,97,255,0.15);color:var(--accent2);">üì¶</span> CQRS Pattern</h4>
      <p>Write-heavy paths (location updates) use different stores than read-heavy paths (driver lookup). Kafka decouples writes from reads.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(255,107,107,0.15);color:var(--accent3);">üîÑ</span> Rate Limiting</h4>
      <p>API Gateway applies rate limiting per user, per endpoint. Protects backend from abuse and thundering herds during peak traffic.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(255,217,61,0.15);color:var(--accent4);">üåê</span> CDN & Edge Caching</h4>
      <p>Static assets (maps, images) served via CDN. API responses for slowly-changing data (fare rules, city configs) cached at the edge.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(74,158,255,0.15);color:var(--blue);">üèó</span> Service Mesh (Envoy)</h4>
      <p>Envoy sidecar proxies handle service discovery, load balancing, retries, and TLS between microservices. Enables observability at the network level.</p>
    </div>
    <div class="comp-card">
      <h4><span class="comp-icon" style="background:rgba(78,205,196,0.15);color:var(--accent5);">üõ°</span> Multi-Region Deployment</h4>
      <p>Active-active deployment across multiple data centers. DNS-based routing sends users to the nearest region. Failover happens automatically.</p>
    </div>
  </div>

  <div class="diagram-box">
    <div class="diagram-title">Scaling Strategy Overview</div>
    <svg viewBox="0 0 1050 280" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:1050px;">
      <rect width="1050" height="280" fill="var(--surface)" rx="12"/>

      <!-- Horizontal scaling pipeline -->
      <rect x="30" y="30" width="170" height="100" rx="10" fill="#12121a" stroke="#4a9eff" stroke-width="1.5"/>
      <text x="115" y="60" fill="#4a9eff" font-size="14" text-anchor="middle" font-weight="700">Clients</text>
      <text x="115" y="80" fill="#8888a0" font-size="10" text-anchor="middle">20M+ rides/day</text>
      <text x="115" y="95" fill="#8888a0" font-size="10" text-anchor="middle">5M+ active drivers</text>
      <text x="115" y="110" fill="#8888a0" font-size="10" text-anchor="middle">100M+ location pings/min</text>

      <text x="215" y="80" fill="#4a9eff" font-size="20">‚Üí</text>

      <rect x="240" y="30" width="140" height="100" rx="10" fill="#12121a" stroke="#00d4aa" stroke-width="1.5"/>
      <text x="310" y="58" fill="#00d4aa" font-size="13" text-anchor="middle" font-weight="700">CDN + LB</text>
      <text x="310" y="80" fill="#8888a0" font-size="10" text-anchor="middle">Global edge</text>
      <text x="310" y="95" fill="#8888a0" font-size="10" text-anchor="middle">SSL termination</text>
      <text x="310" y="110" fill="#8888a0" font-size="10" text-anchor="middle">Rate limiting</text>

      <text x="395" y="80" fill="#00d4aa" font-size="20">‚Üí</text>

      <rect x="420" y="20" width="170" height="120" rx="10" fill="#12121a" stroke="#7b61ff" stroke-width="1.5"/>
      <text x="505" y="48" fill="#7b61ff" font-size="13" text-anchor="middle" font-weight="700">API Gateway</text>
      <text x="505" y="70" fill="#8888a0" font-size="10" text-anchor="middle">Auth & Routing</text>
      <text x="505" y="85" fill="#8888a0" font-size="10" text-anchor="middle">Circuit breaker</text>
      <text x="505" y="100" fill="#8888a0" font-size="10" text-anchor="middle">Request shaping</text>
      <text x="505" y="120" fill="#4ecdc4" font-size="10" text-anchor="middle">Horizontally scaled</text>

      <text x="605" y="80" fill="#7b61ff" font-size="20">‚Üí</text>

      <rect x="625" y="20" width="170" height="120" rx="10" fill="#12121a" stroke="#ffd93d" stroke-width="1.5"/>
      <text x="710" y="48" fill="#ffd93d" font-size="13" text-anchor="middle" font-weight="700">Microservices</text>
      <text x="710" y="70" fill="#8888a0" font-size="10" text-anchor="middle">2000+ services</text>
      <text x="710" y="85" fill="#8888a0" font-size="10" text-anchor="middle">Auto-scaling on K8s</text>
      <text x="710" y="100" fill="#8888a0" font-size="10" text-anchor="middle">gRPC + Kafka</text>
      <text x="710" y="120" fill="#4ecdc4" font-size="10" text-anchor="middle">Domain-isolated</text>

      <text x="810" y="80" fill="#ffd93d" font-size="20">‚Üí</text>

      <rect x="835" y="20" width="180" height="120" rx="10" fill="#12121a" stroke="#ff6b6b" stroke-width="1.5"/>
      <text x="925" y="48" fill="#ff6b6b" font-size="13" text-anchor="middle" font-weight="700">Data Stores</text>
      <text x="925" y="70" fill="#8888a0" font-size="10" text-anchor="middle">Sharded Postgres</text>
      <text x="925" y="85" fill="#8888a0" font-size="10" text-anchor="middle">Redis cluster</text>
      <text x="925" y="100" fill="#8888a0" font-size="10" text-anchor="middle">Cassandra ring</text>
      <text x="925" y="120" fill="#4ecdc4" font-size="10" text-anchor="middle">Per-region sharding</text>

      <!-- Bottom summary -->
      <rect x="30" y="170" width="990" height="90" rx="10" fill="rgba(0,212,170,0.04)" stroke="rgba(0,212,170,0.15)"/>
      <text x="525" y="200" fill="#00d4aa" font-size="14" text-anchor="middle" font-weight="700">Key Scaling Principles</text>
      <text x="180" y="228" fill="#e8e8f0" font-size="11" text-anchor="middle">Horizontal Auto-Scaling</text>
      <text x="180" y="246" fill="#8888a0" font-size="10" text-anchor="middle">Stateless services on K8s</text>
      <text x="420" y="228" fill="#e8e8f0" font-size="11" text-anchor="middle">Geo-Sharding</text>
      <text x="420" y="246" fill="#8888a0" font-size="10" text-anchor="middle">Data partitioned by region</text>
      <text x="640" y="228" fill="#e8e8f0" font-size="11" text-anchor="middle">Event-Driven Async</text>
      <text x="640" y="246" fill="#8888a0" font-size="10" text-anchor="middle">Kafka decouples services</text>
      <text x="870" y="228" fill="#e8e8f0" font-size="11" text-anchor="middle">Graceful Degradation</text>
      <text x="870" y="246" fill="#8888a0" font-size="10" text-anchor="middle">Circuit breakers + fallbacks</text>
    </svg>
  </div>
</section>

<!-- 8. SUMMARY -->
<section id="summary" style="border-bottom: 1px solid var(--border);">
  <div class="section-label">08 ‚Äî Summary</div>
  <h2>Architecture Summary</h2>
  <div class="callout">
    <strong>TL;DR:</strong> Uber's HLD is a microservices-based, event-driven architecture. The core innovation lies in its <strong>real-time geospatial indexing (H3)</strong>, <strong>batched global matching optimization</strong>, <strong>polyglot persistence strategy</strong>, and <strong>geo-sharded scaling model</strong>. Every component is designed for low-latency, high-throughput, and fault tolerance ‚Äî because when you're moving millions of people in real-time, every second counts.
  </div>
  <table class="req-table" style="margin-top: 24px;">
    <thead><tr><th>Component</th><th>Technology</th><th>Why</th></tr></thead>
    <tbody>
      <tr><td>API Gateway</td><td>Nginx / Envoy</td><td>Routing, auth, rate-limiting, SSL</td></tr>
      <tr><td>Service-to-service</td><td>gRPC (sync), Kafka (async)</td><td>Low latency + decoupled events</td></tr>
      <tr><td>Location Index</td><td>H3 hexagonal + Redis</td><td>O(1) proximity lookups</td></tr>
      <tr><td>Primary DB</td><td>PostgreSQL (sharded)</td><td>ACID for transactions</td></tr>
      <tr><td>Cache / Live State</td><td>Redis Cluster</td><td>Sub-ms reads for locations</td></tr>
      <tr><td>Time-series / Logs</td><td>Cassandra</td><td>High-write, append-only</td></tr>
      <tr><td>Real-time Comms</td><td>WebSockets + Push</td><td>Live tracking, instant alerts</td></tr>
      <tr><td>Orchestration</td><td>Kubernetes</td><td>Auto-scaling, rolling deploys</td></tr>
      <tr><td>Observability</td><td>Prometheus, Grafana, Jaeger</td><td>Metrics, dashboards, tracing</td></tr>
    </tbody>
  </table>
</section>

</div>

<footer>
  Uber High-Level Design ‚Äî System Design Reference
</footer>

</body>
</html>
